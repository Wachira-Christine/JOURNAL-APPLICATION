<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Calendar</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&display=swap" rel="stylesheet">


    <style>
        body { font-family: "Merriweather"; margin:0; padding:0; background:#f9f9f9;background-image: url('images/calendar.jpeg'); }
        header { display:flex; justify-content:space-between; align-items:center; padding:10px; background:#A0522D;; color:white; }
        header button { padding:5px 10px; border:none; border-radius:5px; cursor:pointer; color:white; background:#3E1F1F; }
        .month-nav { display:flex; justify-content:center; gap:10px; margin:10px 0; }
        .month-nav button { padding:5px 10px; border:none; border-radius:5px; background:#3E1F1F; color:white; cursor:pointer; }
        #calendar { display:grid; grid-template-columns: repeat(7, 1fr); gap:5px; padding:10px; }
        .day { padding:15px; background:#fff; border-radius:5px; cursor:pointer; text-align:center; min-height:60px; position:relative; box-shadow:0 2px 4px rgba(0,0,0,0.1);}
        .day:hover { background:#e0e0ff; }
        .event { font-size:0.8em; margin-top:5px; border-radius:3px; padding:2px 4px; color:white; display:block; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

        /* Modal styles */
        .modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color: rgba(0,0,0,0.4);}
        .modal-content { background-color:#fefefe; margin:10% auto; padding:20px; border-radius:10px; width:90%; max-width:400px; }
        .close-btn { color:#aaa; float:right; font-size:24px; cursor:pointer; }
        .close-btn:hover { color:black; }
        #eventList { margin-bottom:10px; }
        .event-item { display:flex; justify-content:space-between; align-items:center; margin:5px 0; padding:5px; border-radius:5px; color:white; }
        .event-item button { margin-left:5px; background:#fff; color:#574fd6; border:none; padding:2px 5px; border-radius:3px; cursor:pointer; }
        .event-item button:hover { background:#eee; }
        #newEventInput { width: calc(100% - 90px); padding:5px; margin-right:5px; }
        #addEventBtn { padding:5px 10px; border:none; border-radius:5px; background:#574fd6; color:white; cursor:pointer; }
    </style>
</head>


<body>

<header>
    <h1 id="monthYear"></h1>
    <button onclick="window.location.href='index.html'">Back</button>
</header>

<div class="month-nav">
    <button id="prevMonth">&lt; Previous</button>
    <button id="nextMonth">Next &gt;</button>
</div>

<div id="calendar"></div>

<!-- Day Modal -->
<div id="dayModal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2 id="modalDate"></h2>
        <div id="eventList"></div>
        <input type="text" id="newEventInput" placeholder="Add new event..." />
        <button id="addEventBtn">Add Event</button>
    </div>
</div>

<script>
    const calendarDiv = document.getElementById('calendar');
    const monthYearHeader = document.getElementById('monthYear');
    let currentDate = new Date();

    // Modal elements
    const dayModal = document.getElementById('dayModal');
    const modalDate = document.getElementById('modalDate');
    const eventList = document.getElementById('eventList');
    const newEventInput = document.getElementById('newEventInput');
    const addEventBtn = document.getElementById('addEventBtn');
    const closeBtn = document.querySelector('.close-btn');

    let selectedDayKey = "";

    // Load events from localStorage
    let events = JSON.parse(localStorage.getItem('calendarEvents')) || {};

    // Save events to localStorage
    function saveEvents() {
        localStorage.setItem('calendarEvents', JSON.stringify(events));
    }

    const weekDays = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
    const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];

    // Render calendar
    function renderCalendar(date){
        calendarDiv.innerHTML = "";
        monthYearHeader.textContent = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;

        // Weekday headers
        weekDays.forEach(d=>{
            const div = document.createElement('div');
            div.textContent = d;
            div.style.fontWeight = 'bold';
            div.style.textAlign = 'center';
            calendarDiv.appendChild(div);
        });

        const firstDay = new Date(date.getFullYear(), date.getMonth(), 1).getDay();
        const daysInMonth = new Date(date.getFullYear(), date.getMonth()+1, 0).getDate();

        for(let i=0;i<firstDay;i++){
            calendarDiv.appendChild(document.createElement('div'));
        }

        for(let i=1;i<=daysInMonth;i++){
            const dayDiv = document.createElement('div');
            dayDiv.classList.add('day');
            dayDiv.dataset.date = `${date.getFullYear()}-${date.getMonth()+1}-${i}`;
            dayDiv.textContent = i;

            const dayKey = dayDiv.dataset.date;

            // Render existing events as colored divs
            if(events[dayKey]){
                events[dayKey].forEach(ev=>{
                    const evDiv = document.createElement('div');
                    evDiv.classList.add('event');
                    evDiv.style.backgroundColor = ev.color;
                    evDiv.textContent = ev.text;
                    dayDiv.appendChild(evDiv);
                });
            }

            // Click to open day modal
            dayDiv.addEventListener('click', ()=>{
                selectedDayKey = dayKey;
                modalDate.textContent = `${monthNames[date.getMonth()]} ${i}, ${date.getFullYear()}`;
                newEventInput.value = "";
                renderEventList();
                dayModal.style.display = "block";
            });

            calendarDiv.appendChild(dayDiv);
        }
    }

    // Render events inside modal
    function renderEventList() {
        eventList.innerHTML = "";
        if(events[selectedDayKey]){
            events[selectedDayKey].forEach((ev, index)=>{
                const div = document.createElement('div');
                div.classList.add('event-item');
                div.style.backgroundColor = ev.color;
                div.textContent = ev.text;

                // Edit button
                const editBtn = document.createElement('button');
                editBtn.textContent = "Edit";
                editBtn.addEventListener('click', ()=>{
                    const newText = prompt("Edit event:", ev.text);
                    if(newText === null) return;
                    if(newText.trim() === ""){
                        events[selectedDayKey].splice(index,1);
                    } else {
                        events[selectedDayKey][index].text = newText;
                    }
                    if(events[selectedDayKey].length === 0) delete events[selectedDayKey];
                    saveEvents();
                    renderEventList();
                    renderCalendar(currentDate);
                });

                // Delete button
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = "Delete";
                deleteBtn.addEventListener('click', ()=>{
                    events[selectedDayKey].splice(index,1);
                    if(events[selectedDayKey].length === 0) delete events[selectedDayKey];
                    saveEvents();
                    renderEventList();
                    renderCalendar(currentDate);
                });

                div.appendChild(editBtn);
                div.appendChild(deleteBtn);
                eventList.appendChild(div);
            });
        }
    }

    // Add new event
    addEventBtn.addEventListener('click', ()=>{
        const text = newEventInput.value.trim();
        if(text === "") return;
        const color = '#' + Math.floor(Math.random()*16777215).toString(16);
        if(!events[selectedDayKey]) events[selectedDayKey] = [];
        events[selectedDayKey].push({text:text,color:color});
        saveEvents();
        newEventInput.value = "";
        renderEventList();
        renderCalendar(currentDate);
    });

    // Close modal
    closeBtn.addEventListener('click', ()=>{
        dayModal.style.display = "none";
    });

    // Close modal on outside click
    window.addEventListener('click', (e)=>{
        if(e.target == dayModal) dayModal.style.display = "none";
    });

    // Initial render
    renderCalendar(currentDate);

    // Month navigation
    document.getElementById('prevMonth').addEventListener('click', ()=>{
        currentDate.setMonth(currentDate.getMonth()-1);
        renderCalendar(currentDate);
    });
    document.getElementById('nextMonth').addEventListener('click', ()=>{
        currentDate.setMonth(currentDate.getMonth()+1);
        renderCalendar(currentDate);
    });
</script>

</body>
</html>

